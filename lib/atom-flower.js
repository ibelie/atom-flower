"use 6to5";

const {CompositeDisposable} = require('atom');
const Flower = require('./flower/flower');
const FlowerTree = require('./flower/flower-tree');
const FlowerGantt = require('./flower/flower-gantt');
const BottomPanel = require('./panel/panel-bottom');
const RightPanel = require('./panel/panel-right');

/**
 * The composite disposable that stores the package's subscriptions.
 */
var subscriptions = null;

/*
<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M23.881 62.017h289.82v167.793h-289.82v-167.793zM283.194 519.627h289.82v167.793h-289.82v-167.793zM283.194 115.402h137.283v45.761h-137.283v-45.761zM367.089 145.909h45.761v160.164h-45.761v-160.164zM367.089 428.107h45.761v160.164h-45.761v-160.164zM573.015 618.775h137.283v45.761h-137.283v-45.761zM664.537 649.283h45.761v129.658h-45.761v-129.658zM939.107 313.699v91.524h-594.898v-91.524h594.898M1000.119 252.685h-716.929v213.553h716.929v-213.553zM939.107 817.074v83.893h-305.074v-83.893h305.074M1000.119 756.060h-427.107v205.926h427.107v-205.926z"/></svg>

 */

module.exports = {
	// Configuration
	config: {
		FlowerDefinationPath: {
			type: 'string',
			'default': ''
		}
	},

	/**
	 * Activates the flower package.
	 */
	activate: (state) => {
		let bottomPanel = new BottomPanel();
		bottomPanel.attach();
		let rightPanel = new RightPanel();
		rightPanel.attach();

		let gantt = bottomPanel.addTabPanel(`
			<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M23.881 62.017h289.82v167.793h-289.82v-167.793zM283.194 519.627h289.82v167.793h-289.82v-167.793zM283.194 115.402h137.283v45.761h-137.283v-45.761zM367.089 145.909h45.761v160.164h-45.761v-160.164zM367.089 428.107h45.761v160.164h-45.761v-160.164zM573.015 618.775h137.283v45.761h-137.283v-45.761zM664.537 649.283h45.761v129.658h-45.761v-129.658zM939.107 313.699v91.524h-594.898v-91.524h594.898M1000.119 252.685h-716.929v213.553h716.929v-213.553zM939.107 817.074v83.893h-305.074v-83.893h305.074M1000.119 756.060h-427.107v205.926h427.107v-205.926z"/></svg>
			`, 'Gantt');
		let debug = bottomPanel.addTabPanel(`
			<svg viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11 10h3V9h-3V8l3.17-1.03-.34-.94L11 7V6c0-.55-.45-1-1-1V4c0-.48-.36-.88-.83-.97L10.2 2H12V1H9.8l-2 2h-.59L5.2 1H3v1h1.8l1.03 1.03C5.36 3.12 5 3.51 5 4v1c-.55 0-1 .45-1 1v1l-2.83-.97-.34.94L4 8v1H1v1h3v1L.83 12.03l.34.94L4 12v1c0 .55.45 1 1 1h1l1-1V6h1v7l1 1h1c.55 0 1-.45 1-1v-1l2.83.97.34-.94L11 11v-1zM9 5H6V4h3v1z"></path></svg>
			`, 'Debug');

		let tool1 = rightPanel.addToolPanel(`
			<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M736.232934 118.192202h-448.922521L62.848129 506.970675 287.309389 895.749148h448.922521l224.46126-388.778473L736.232934 118.192202zM714.634073 858.33945H308.90825l-202.862399-351.368775L308.909274 155.602924h405.725823l202.862399 351.368775L714.634073 858.33945zM680.117875 521.647048c-14.008799 0-26.808389 5.145024-36.64076 13.634057l-136.371287-77.926889A93.415201 93.415201 0 0 0 511.771674 428.121266a93.632265 93.632265 0 0 0-3.184284-24.257891l95.178332-47.589166c10.092438 9.734078 23.812501 15.731998 38.941431 15.731998 30.991985 0 56.115059-25.124098 56.115059-56.115059 0-30.991985-25.124098-56.115059-56.115059-56.115059-30.991985 0-56.115059 25.124098-56.115059 56.115059 0 2.346745 0.16075 4.653559 0.44027 6.924537l-95.186523 47.593261c-17.122434-21.805686-43.725023-35.813461-73.599949-35.813461-51.652967 0-93.525781 41.872814-93.525781 93.525781 0 39.839378 24.913178 73.854896 60.006848 87.333323l-13.646344 81.87499c-26.33945 4.618747-46.361528 27.590638-46.361528 55.252948 0 30.991985 25.124098 56.115059 56.11506 56.115059 30.991985 0 56.115059-25.124098 56.115059-56.115059 0-21.142208-11.696866-39.544499-28.96674-49.112708l13.648391-81.891372c26.64252-0.949142 50.444782-13.038156 66.891453-31.755803l136.38562 77.934055a56.411986 56.411986 0 0 0-0.907162 10.004384c0 30.991985 25.124098 56.115059 56.115059 56.115059 30.991985 0 56.115059-25.124098 56.115059-56.115059 0.002048-30.989937-25.121026-56.114035-56.113011-56.114035z"></path></svg>
			`, 'Tool1');
		let tool2 = rightPanel.addToolPanel(`
			<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M736.232934 118.192202h-448.922521L62.848129 506.970675 287.309389 895.749148h448.922521l224.46126-388.778473L736.232934 118.192202zM714.634073 858.33945H308.90825l-202.862399-351.368775L308.909274 155.602924h405.725823l202.862399 351.368775L714.634073 858.33945z" fill=""></path><path d="M335.341898 342.768138l-58.928696 102.067032 58.928696 102.067033h117.856368l58.928696-102.067033-58.928696-102.067032zM453.198266 546.902203l-58.927672 102.068056 58.927672 102.067033h117.857392l58.928696-102.067033-58.928696-102.068056zM688.91305 342.768138H571.055658l-58.928696 102.067032 58.928696 102.067033h117.857392l58.928696-102.067033z" fill=""></path></svg>
			`, 'Tool2');
		let tool3 = rightPanel.addToolPanel(`
			<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M736.232934 118.192202h-448.922521L62.848129 506.970675 287.309389 895.749148h448.922521l224.46126-388.778473L736.232934 118.192202zM714.634073 858.33945H308.90825l-202.862399-351.368775L308.909274 155.602924h405.725823l202.862399 351.368775L714.634073 858.33945z" fill=""></path><path d="M702.027997 467.579759c-1.821492 0-3.613291 0.121842-5.377446 0.334811l-57.531092-89.131266c9.021454-11.03134 14.444974-25.115907 14.444974-40.445518 0-35.285136-28.706673-63.992833-63.992833-63.992833s-63.992833 28.707697-63.992833 63.992833c0 20.231974 9.448414 38.289216 24.153455 50.023965L432.361176 623.290191a57.620171 57.620171 0 0 0-6.604061-0.392148 57.306862 57.306862 0 0 0-12.382869 1.360744l-56.37615-88.752428a44.318876 44.318876 0 0 0 6.635801-23.387588c0-24.597821-19.941191-44.539012-44.539012-44.539012s-44.539012 19.941191-44.539011 44.539012 19.941191 44.539012 44.539011 44.539011c1.710912 0 3.397252-0.106484 5.057994-0.293855l56.384341 88.764715c-7.465148 9.655239-11.918025 21.757563-11.918025 34.907322 0 31.556146 25.581775 57.137921 57.13792 57.137921s57.137921-25.581775 57.137921-57.137921c0-15.254867-5.989729-29.102916-15.731998-39.349961l119.124962-238.438319a63.816725 63.816725 0 0 0 20.238117-2.214664l57.425632 88.967444a44.329115 44.329115 0 0 0-6.462764 23.117283c0 24.597821 19.941191 44.539012 44.539012 44.539011s44.539012-19.941191 44.539011-44.539011c0-24.596797-19.941191-44.537988-44.539011-44.537988zM564.48641 338.33881c0-13.831667 11.2525-25.08519 25.08519-25.08519s25.08519 11.253524 25.08519 25.08519-11.2525 25.08519-25.08519 25.085191-25.08519-11.253524-25.08519-25.085191z" fill=""></path></svg>
			`, 'Tool3');

		tool1.innerHTML = `
			<img src = 'http://www.conceptdraw.com/How-To-Guide/picture/Designelements-Flowchart.png' style = 'position:absolute;left:0px;top:0px;clip:rect(0px 350px 654px 0px)'></img>
		`;
		tool2.innerHTML = `
			<img src = 'http://www.conceptdraw.com/How-To-Guide/picture/Designelements-Flowchart.png' style = 'position:absolute;left:-350px;top:0px;clip:rect(0px 755px 654px 350px)'></img>
		`;
		tool3.innerHTML = `
			<img src = 'http://www.conceptdraw.com/How-To-Guide/picture/Designelements-Flowchart.png' style = 'position:absolute;left:-755px;top:0px;clip:rect(0px 1065px 654px 755px)'></img>
		`;

		if (!subscriptions) {
			subscriptions = new CompositeDisposable();
			subscriptions.add(atom.workspace.observeActiveTextEditor((editor) => {
				let path = editor && editor.getPath();
				if (path && path.endsWith('.flw')) {
					let flower = Flower.forEditor(editor);
					flower.getView(FlowerGantt).attach(gantt);
					flower.getView(FlowerTree).attach(rightPanel.getMainPanel());
					bottomPanel.setActive('Gantt');
					rightPanel.setActive(true);
				} else {
					bottomPanel.setActive(false);
					rightPanel.setActive(false);
				}
			}));
		}
		atom.config.observe('atom-flower', (cfg) => console.info(cfg));
		console.info(atom.config.get('atom-flower'));
	},

	flowerGanttProvider: FlowerTree.viewProvider,
	flowerTreeProvider: FlowerGantt.viewProvider,

	/**
	 * Deactivates the flower package.
	 */
	deactivate: () => {
		if (subscriptions) {
			subscriptions.dispose();
			subscriptions = null;
		}
		Flower.destroyAll();
	}
};
